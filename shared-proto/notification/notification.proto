syntax = "proto3";

package notification;

option go_package = "smartcam-proto/notification";

import "google/protobuf/timestamp.proto";

// Notification Service Definition
service NotificationService {
    // Notification Management
    rpc CreateNotification(CreateNotificationRequest) returns (CreateNotificationResponse);
    rpc GetNotification(GetNotificationRequest) returns (GetNotificationResponse);
    rpc ListNotifications(ListNotificationsRequest) returns (ListNotificationsResponse);
    rpc UpdateNotification(UpdateNotificationRequest) returns (UpdateNotificationResponse);
    rpc DeleteNotification(DeleteNotificationRequest) returns (DeleteNotificationResponse);

    // Notification Status Management
    rpc MarkAsRead(MarkAsReadRequest) returns (MarkAsReadResponse);
    rpc MarkAllAsRead(MarkAllAsReadRequest) returns (MarkAllAsReadResponse);

    // Notification Settings
    rpc GetNotificationSettings(GetNotificationSettingsRequest) returns (GetNotificationSettingsResponse);
    rpc UpdateNotificationSettings(UpdateNotificationSettingsRequest) returns (UpdateNotificationSettingsResponse);

    // Notification Templates
    rpc CreateTemplate(CreateTemplateRequest) returns (CreateTemplateResponse);
    rpc GetTemplate(GetTemplateRequest) returns (GetTemplateResponse);
    rpc ListTemplates(ListTemplatesRequest) returns (ListTemplatesResponse);
    rpc UpdateTemplate(UpdateTemplateRequest) returns (UpdateTemplateResponse);
    rpc DeleteTemplate(DeleteTemplateRequest) returns (DeleteTemplateResponse);

    // Bulk Operations
    rpc SendBulkNotifications(SendBulkNotificationsRequest) returns (SendBulkNotificationsResponse);
    rpc GetNotificationStats(GetNotificationStatsRequest) returns (GetNotificationStatsResponse);
}

// Enums
enum NotificationType {
    NOTIFICATION_TYPE_UNSPECIFIED = 0;
    NOTIFICATION_TYPE_INFO = 1;
    NOTIFICATION_TYPE_WARNING = 2;
    NOTIFICATION_TYPE_ERROR = 3;
    NOTIFICATION_TYPE_SUCCESS = 4;
    NOTIFICATION_TYPE_ALERT = 5;
}

enum NotificationChannel {
    NOTIFICATION_CHANNEL_UNSPECIFIED = 0;
    NOTIFICATION_CHANNEL_EMAIL = 1;
    NOTIFICATION_CHANNEL_SMS = 2;
    NOTIFICATION_CHANNEL_PUSH = 3;
    NOTIFICATION_CHANNEL_IN_APP = 4;
    NOTIFICATION_CHANNEL_WEBHOOK = 5;
    NOTIFICATION_CHANNEL_SLACK = 6;
}

enum NotificationStatus {
    NOTIFICATION_STATUS_UNSPECIFIED = 0;
    NOTIFICATION_STATUS_PENDING = 1;
    NOTIFICATION_STATUS_SENT = 2;
    NOTIFICATION_STATUS_DELIVERED = 3;
    NOTIFICATION_STATUS_READ = 4;
    NOTIFICATION_STATUS_FAILED = 5;
    NOTIFICATION_STATUS_CANCELLED = 6;
}

enum NotificationPriority {
    NOTIFICATION_PRIORITY_UNSPECIFIED = 0;
    NOTIFICATION_PRIORITY_LOW = 1;
    NOTIFICATION_PRIORITY_NORMAL = 2;
    NOTIFICATION_PRIORITY_HIGH = 3;
    NOTIFICATION_PRIORITY_URGENT = 4;
}

// Message Definitions
message Notification {
    uint32 id = 1;
    string uuid = 2;
    google.protobuf.Timestamp created_at = 3;
    google.protobuf.Timestamp updated_at = 4;
    google.protobuf.Timestamp deleted_at = 5;

    // Multi-tenant support
    string tenant_id = 6;

    // Notification details
    string recipient = 7;
    uint32 recipient_user_id = 8;
    NotificationType type = 9;
    NotificationChannel channel = 10;
    NotificationStatus status = 11;
    NotificationPriority priority = 12;

    // Content
    string title = 13;
    string message = 14;
    string template_id = 15;
    map<string, string> template_data = 16;

    // Metadata
    string source_type = 17;
    uint32 source_id = 18;
    map<string, string> metadata = 19;

    // Delivery details
    google.protobuf.Timestamp sent_at = 20;
    google.protobuf.Timestamp delivered_at = 21;
    google.protobuf.Timestamp read_at = 22;
    string error_message = 23;
    uint32 retry_count = 24;
    google.protobuf.Timestamp next_retry_at = 25;

    // Tracking
    uint32 created_by = 26;
    uint32 updated_by = 27;
}

message NotificationTemplate {
    uint32 id = 1;
    string uuid = 2;
    google.protobuf.Timestamp created_at = 3;
    google.protobuf.Timestamp updated_at = 4;
    google.protobuf.Timestamp deleted_at = 5;

    // Multi-tenant support
    string tenant_id = 6;

    // Template details
    string name = 7;
    string description = 8;
    NotificationType type = 9;
    NotificationChannel channel = 10;

    // Content templates
    string title_template = 11;
    string message_template = 12;
    map<string, string> default_data = 13;

    // Settings
    bool is_active = 14;
    string language = 15;

    // Tracking
    uint32 created_by = 16;
    uint32 updated_by = 17;
}

message NotificationSettings {
    uint32 id = 1;
    string uuid = 2;
    google.protobuf.Timestamp created_at = 3;
    google.protobuf.Timestamp updated_at = 4;

    // Multi-tenant support
    string tenant_id = 5;
    uint32 user_id = 6;

    // Channel preferences
    bool email_enabled = 7;
    bool sms_enabled = 8;
    bool push_enabled = 9;
    bool in_app_enabled = 10;

    // Type preferences
    bool info_notifications = 11;
    bool warning_notifications = 12;
    bool error_notifications = 13;
    bool success_notifications = 14;
    bool alert_notifications = 15;

    // Frequency settings
    string quiet_hours_start = 16;
    string quiet_hours_end = 17;
    string timezone = 18;
    bool weekend_notifications = 19;
}

// Request/Response Messages

// Create Notification
message CreateNotificationRequest {
    string tenant_id = 1;
    string recipient = 2;
    uint32 recipient_user_id = 3;
    NotificationType type = 4;
    NotificationChannel channel = 5;
    NotificationPriority priority = 6;
    string title = 7;
    string message = 8;
    string template_id = 9;
    map<string, string> template_data = 10;
    string source_type = 11;
    uint32 source_id = 12;
    map<string, string> metadata = 13;
    uint32 created_by = 14;
}

message CreateNotificationResponse {
    Notification notification = 1;
}

// Get Notification
message GetNotificationRequest {
    uint32 id = 1;
    string uuid = 2;
    string tenant_id = 3;
}

message GetNotificationResponse {
    Notification notification = 1;
}

// List Notifications
message ListNotificationsRequest {
    string tenant_id = 1;
    uint32 user_id = 2;
    uint32 page = 3;
    uint32 limit = 4;
    string sort_by = 5;
    string sort_order = 6;
    NotificationType type = 7;
    NotificationChannel channel = 8;
    NotificationStatus status = 9;
    bool unread_only = 10;
}

message ListNotificationsResponse {
    repeated Notification notifications = 1;
    uint32 total = 2;
    uint32 page = 3;
    uint32 limit = 4;
    uint32 total_pages = 5;
}

// Update Notification
message UpdateNotificationRequest {
    uint32 id = 1;
    string tenant_id = 2;
    NotificationStatus status = 3;
    string error_message = 4;
    uint32 updated_by = 5;
}

message UpdateNotificationResponse {
    Notification notification = 1;
}

// Delete Notification
message DeleteNotificationRequest {
    uint32 id = 1;
    string tenant_id = 2;
    uint32 deleted_by = 3;
}

message DeleteNotificationResponse {
    bool success = 1;
}

// Mark As Read
message MarkAsReadRequest {
    uint32 id = 1;
    string tenant_id = 2;
    uint32 user_id = 3;
}

message MarkAsReadResponse {
    bool success = 1;
    google.protobuf.Timestamp read_at = 2;
}

// Mark All As Read
message MarkAllAsReadRequest {
    string tenant_id = 1;
    uint32 user_id = 2;
}

message MarkAllAsReadResponse {
    bool success = 1;
    uint32 updated_count = 2;
}

// Notification Settings
message GetNotificationSettingsRequest {
    string tenant_id = 1;
    uint32 user_id = 2;
}

message GetNotificationSettingsResponse {
    NotificationSettings settings = 1;
}

message UpdateNotificationSettingsRequest {
    string tenant_id = 1;
    uint32 user_id = 2;
    bool email_enabled = 3;
    bool sms_enabled = 4;
    bool push_enabled = 5;
    bool in_app_enabled = 6;
    bool info_notifications = 7;
    bool warning_notifications = 8;
    bool error_notifications = 9;
    bool success_notifications = 10;
    bool alert_notifications = 11;
    string quiet_hours_start = 12;
    string quiet_hours_end = 13;
    string timezone = 14;
    bool weekend_notifications = 15;
}

message UpdateNotificationSettingsResponse {
    NotificationSettings settings = 1;
}

// Templates
message CreateTemplateRequest {
    string tenant_id = 1;
    string name = 2;
    string description = 3;
    NotificationType type = 4;
    NotificationChannel channel = 5;
    string title_template = 6;
    string message_template = 7;
    map<string, string> default_data = 8;
    string language = 9;
    uint32 created_by = 10;
}

message CreateTemplateResponse {
    NotificationTemplate template = 1;
}

message GetTemplateRequest {
    uint32 id = 1;
    string uuid = 2;
    string tenant_id = 3;
}

message GetTemplateResponse {
    NotificationTemplate template = 1;
}

message ListTemplatesRequest {
    string tenant_id = 1;
    uint32 page = 2;
    uint32 limit = 3;
    NotificationType type = 4;
    NotificationChannel channel = 5;
    bool active_only = 6;
}

message ListTemplatesResponse {
    repeated NotificationTemplate templates = 1;
    uint32 total = 2;
    uint32 page = 3;
    uint32 limit = 4;
    uint32 total_pages = 5;
}

message UpdateTemplateRequest {
    uint32 id = 1;
    string tenant_id = 2;
    string name = 3;
    string description = 4;
    string title_template = 5;
    string message_template = 6;
    map<string, string> default_data = 7;
    bool is_active = 8;
    uint32 updated_by = 9;
}

message UpdateTemplateResponse {
    NotificationTemplate template = 1;
}

message DeleteTemplateRequest {
    uint32 id = 1;
    string tenant_id = 2;
    uint32 deleted_by = 3;
}

message DeleteTemplateResponse {
    bool success = 1;
}

// Bulk Operations
message SendBulkNotificationsRequest {
    string tenant_id = 1;
    repeated string recipients = 2;
    repeated uint32 recipient_user_ids = 3;
    NotificationType type = 4;
    NotificationChannel channel = 5;
    NotificationPriority priority = 6;
    string title = 7;
    string message = 8;
    string template_id = 9;
    map<string, string> template_data = 10;
    string source_type = 11;
    uint32 source_id = 12;
    uint32 created_by = 13;
}

message SendBulkNotificationsResponse {
    repeated Notification notifications = 1;
    uint32 total_sent = 2;
    uint32 total_failed = 3;
}

// Statistics
message GetNotificationStatsRequest {
    string tenant_id = 1;
    uint32 user_id = 2;
    google.protobuf.Timestamp from_date = 3;
    google.protobuf.Timestamp to_date = 4;
}

message NotificationStats {
    uint32 total_sent = 1;
    uint32 total_delivered = 2;
    uint32 total_read = 3;
    uint32 total_failed = 4;
    uint32 unread_count = 5;
    map<string, uint32> by_type = 6;
    map<string, uint32> by_channel = 7;
    map<string, uint32> by_status = 8;
}

message GetNotificationStatsResponse {
    NotificationStats stats = 1;
}